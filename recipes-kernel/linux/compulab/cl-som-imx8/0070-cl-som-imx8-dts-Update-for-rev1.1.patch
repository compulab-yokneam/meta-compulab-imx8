From 6e59fd4c9ec50ce3b567b904b327359e1f2977b9 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Wed, 31 Oct 2018 13:56:59 +0200
Subject: [PATCH 70/72] cl-som-imx8: dts: Update for rev1.1

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/cl-som-imx8.dts | 49 ++++++++++++++++++----------
 1 file changed, 32 insertions(+), 17 deletions(-)

diff --git a/arch/arm64/boot/dts/compulab/cl-som-imx8.dts b/arch/arm64/boot/dts/compulab/cl-som-imx8.dts
index 099ecde..b0dc4bf 100644
--- a/arch/arm64/boot/dts/compulab/cl-som-imx8.dts
+++ b/arch/arm64/boot/dts/compulab/cl-som-imx8.dts
@@ -17,15 +17,9 @@
 #include "../freescale/fsl-imx8mq.dtsi"
 
 / {
-	model = "CompuLab CL-SOM-iMX8";
+	model = "CompuLab CL-SOM-iMX8 (rev1.1)";
 	compatible = "compulab,cl-som-imx8", "fsl,imx8mq";
 
-	bcmdhd_wlan_0: bcmdhd_wlan@0 {
-		compatible = "android,bcmdhd_wlan";
-		bcmdhd_fw = "/lib/firmware/bcm/1CX_BCM4356/fw_bcmdhd.bin";
-		bcmdhd_nv = "/lib/firmware/bcm/1CX_BCM4356/bcmdhd.cal";
-	};
-
 	chosen {
 		bootargs = "console=ttymxc2,115200 earlycon=ec_imx6q,0x30880000,115200";
 		stdout-path = &uart3;
@@ -45,6 +39,18 @@
 		#address-cells = <1>;
 		#size-cells = <0>;
 
+		reg_usb_mux: usb_mux {
+			compatible = "regulator-fixed";
+			pinctrl-names = "default";
+			pinctrl-0 = <&pinctrl_usbimux1>;
+			regulator-name = "usb_mux";
+			regulator-min-microvolt = <3300000>;
+			regulator-max-microvolt = <3300000>;
+			gpio = <&gpio1 4 GPIO_ACTIVE_HIGH>;
+			regulator-always-on;
+			enable-active-high;
+		};
+
 		reg_usdhc2_vmmc: usdhc2_vmmc {
 			compatible = "regulator-fixed";
 			regulator-name = "VSD_3V3";
@@ -186,11 +192,16 @@
 		pinctrl_hog: hoggrp {
 			fsl,pins = <
 				MX8MQ_IOMUXC_GPIO1_IO12_GPIO1_IO12	0x16
-				MX8MQ_IOMUXC_NAND_RE_B_GPIO3_IO15	0x16
 				MX8MQ_IOMUXC_NAND_WE_B_GPIO3_IO17	0xC0
 			>;
 		};
 
+		pinctrl_usbimux1: usbmux1grp {
+			fsl,pins = <
+				MX8MQ_IOMUXC_GPIO1_IO04_GPIO1_IO4	0x16
+			>;
+		};
+
 		pinctrl_fec1: fec1grp {
 			fsl,pins = <
 				MX8MQ_IOMUXC_ENET_MDC_ENET1_MDC		0x3
@@ -241,11 +252,10 @@
 
 		pinctrl_pcie1: pcie1grp {
 			fsl,pins = <
-				MX8MQ_IOMUXC_GPIO1_IO02_GPIO1_IO2	0x16 /* WIFI clkreq-gpio  pin#39 */
-				MX8MQ_IOMUXC_SAI3_RXC_GPIO4_IO29 	0x16 /* WIFI disable-gpio pin#41 */
-				MX8MQ_IOMUXC_GPIO1_IO01_GPIO1_IO1	0x16 /* WIFI rest-gpio    pin#23 */
+				MX8MQ_IOMUXC_SAI3_RXC_GPIO4_IO29 	0x16 /* WIFI reset-gpio   */
+				MX8MQ_IOMUXC_GPIO1_IO01_GPIO1_IO1	0x16 /* WIFI disable-gpio */
 
-				MX8MQ_IOMUXC_GPIO1_IO03_GPIO1_IO3	0x16
+				MX8MQ_IOMUXC_GPIO1_IO03_GPIO1_IO3	0x16 /* WIFI pewake */
 				MX8MQ_IOMUXC_GPIO1_IO00_ANAMIX_REF_CLK_32K 0x16
 			>;
 		};
@@ -310,8 +320,6 @@
 				MX8MQ_IOMUXC_ECSPI2_SCLK_UART4_DCE_RX		0x79
 				MX8MQ_IOMUXC_ECSPI2_MISO_UART4_DCE_CTS_B	0x79
 				MX8MQ_IOMUXC_ECSPI2_SS0_UART4_DCE_RTS_B		0x79
-				MX8MQ_IOMUXC_GPIO1_IO04_GPIO1_IO4		0x19
-				MX8MQ_IOMUXC_GPIO1_IO05_GPIO1_IO5		0x19
 			>;
 		};
 
@@ -423,6 +431,12 @@
 				MX8MQ_IOMUXC_SPDIF_RX_SPDIF1_IN		0xd6
 			>;
 		};
+
+		pinctrl_wdog: wdoggrp {
+			fsl,pins = <
+				MX8MQ_IOMUXC_GPIO1_IO02_WDOG1_WDOG_B 0xc6
+			>;
+		};
 	};
 };
 
@@ -614,9 +628,8 @@
 &pcie1{
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_pcie1>;
-	clkreq-gpio = <&gpio1 2 GPIO_ACTIVE_LOW>;   /* pin#39 */
-	disable-gpio = <&gpio4 29 GPIO_ACTIVE_LOW>; /* pin#41 */
-	reset-gpio = <&gpio1 1 GPIO_ACTIVE_LOW>;    /* pin#23 */
+	reset-gpio = <&gpio4 29 GPIO_ACTIVE_LOW>;
+	disable-gpio = <&gpio1 1 GPIO_ACTIVE_LOW>;
 	ext_osc = <0>;
 	hard-wired = <1>;
 	status = "okay";
@@ -795,6 +808,8 @@
 };
 
 &wdog1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_wdog>;
 	fsl,ext-reset-output;
 	status = "okay";
 };
-- 
1.9.1

